<!DOCTYPE html>
<html>

<head>
    <meta charset='UTF-8'>
    <title>Gestion des Étudiants</title>
</head>

<body>
    <h1>Gestion des Étudiants</h1>

    <p><a href="index.html">Retour à l'accueil</a></p>

    <div id='message'></div>

    <h2>Liste des Étudiants</h2>
    <table border="1">
        <thead>
            <tr>
                <th>ID</th>
                <th>Prénom</th>
                <th>Nom</th>
                <th>Date de Naissance</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id='studentsBody'>
        </tbody>
    </table>

    <h2 id='formTitle'>Ajouter un Étudiant</h2>
    <form id='studentForm'>
        <input type='hidden' id='studentId'>

        <p>
            <label>Prénom:</label><br>
            <input type='text' id='firstName' required>
        </p>

        <p>
            <label>Nom:</label><br>
            <input type='text' id='lastName' required>
        </p>

        <p>
            <label>Date de Naissance:</label><br>
            <input type='date' id='birthDate' required>
        </p>

        <p>
            <button type='submit'>Enregistrer</button>
            <button type='button' onclick='resetForm()'>Annuler</button>
        </p>
    </form>

    <script>
        function loadStudents() {
            fetch('students')
                .then(response => response.json())
                .then(students => {
                    const tbody = document.getElementById('studentsBody');
                    tbody.innerHTML = '';
                    students.forEach(student => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${student.idStudent}</td>
                            <td>${student.firstName}</td>
                            <td>${student.lastName}</td>
                            <td>${student.birthDate}</td>
                            <td>
                                <button onclick='editStudent(${student.idStudent})'>Modifier</button>
                                <button onclick='deleteStudent(${student.idStudent})'>Supprimer</button>
                            </td>
                        `;
                        tbody.appendChild(tr);
                    });
                })
                .catch(error => showMessage('Erreur: ' + error));
        }

        function showMessage(msg) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = msg;
            setTimeout(() => messageDiv.textContent = '', 3000);
        }

        function resetForm() {
            document.getElementById('studentForm').reset();
            document.getElementById('studentId').value = '';
            document.getElementById('formTitle').textContent = 'Ajouter un Étudiant';
        }

        function editStudent(id) {
            fetch('students/' + id)
                .then(response => response.json())
                .then(student => {
                    document.getElementById('studentId').value = student.idStudent;
                    document.getElementById('firstName').value = student.firstName;
                    document.getElementById('lastName').value = student.lastName;
                    document.getElementById('birthDate').value = student.birthDate;
                    document.getElementById('formTitle').textContent = 'Modifier un Étudiant';
                })
                .catch(error => showMessage('Erreur: ' + error));
        }

        function deleteStudent(id) {
            if (confirm('Supprimer cet étudiant ?')) {
                fetch('students/' + id, { method: 'DELETE' })
                    .then(response => response.json())
                    .then(data => {
                        showMessage('Étudiant supprimé');
                        loadStudents();
                    })
                    .catch(error => showMessage('Erreur: ' + error));
            }
        }

        document.getElementById('studentForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const id = document.getElementById('studentId').value;
            const formData = new URLSearchParams();
            formData.append('firstName', document.getElementById('firstName').value);
            formData.append('lastName', document.getElementById('lastName').value);
            formData.append('birthDate', document.getElementById('birthDate').value);

            const url = id ? 'students/' + id : 'students';
            const method = id ? 'PUT' : 'POST';

            fetch(url, {
                method: method,
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    showMessage(id ? 'Étudiant modifié' : 'Étudiant ajouté');
                    resetForm();
                    loadStudents();
                })
                .catch(error => showMessage('Erreur: ' + error));
        });

        loadStudents();
    </script>
</body>

</html>